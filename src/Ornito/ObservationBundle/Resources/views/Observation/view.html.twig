{# src/Ornito/ObservationBundle/Ressource/views/Observation/view.html.twig #}

{% extends "::base.html.twig" %}

{% block stylesheets %}{{ parent() }}
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.1/dist/leaflet.css" integrity="sha512-Rksm5RenBEKSKFjgI3a41vrjkw4EVPlJ3+OiI65vTjIdo9brlAacEuKOiQ5OFh7cOI1bkDwLqdLw3Zg0cRJAAQ==" crossorigin=""/>
  <script src="https://unpkg.com/leaflet@1.3.1/dist/leaflet.js" integrity="sha512-/Nsx9X4HebavoBvEBuyp3I7od5tA0UzAxs+j83KgC8PU0kgB4XiK4Lfe4y4cgBtaRJQEIFCW+oC506aPT2L1zw==" crossorigin=""></script>
{% endblock %}

{% block title %}{{ parent() }}
  - Obs'
{% endblock %}

{% block content %}{{ parent() }}
  <!-- CONTENT HERE -->
  <!-- PAGE TITLE -->
  <h1 class="band_title elegantshd">Obs
    <a href="#timeline" class="btn">
      <i class="fa fa-angle-double-down fa-2x"></i>
    </a>
  </h1>
  <hr>
  <div class="col-xs-11 col-md-9 col-lg-8 container">
    <div class="row">
      <div class="col-md-12 ">
        <!-- CONTENT -->
        <div class="container">
          <div>
            <h1 id="timeline" class="page-title">Obs</h1>
          </div>
          <ul class="timeline">
            <!-- TIMELINE ARTICLE -->
            <article class="timeline">
              <li class="timeline-inverted">
                <aside class="timeline-badge">
                  <a title="{{ "Voir le profil"|trans }}" href="{{ (path('ornito_user_profile_show', { username : watching.user.username ,  userId : watching.user.id })) }}">
                    <span class="profil-img">
                      {% if watching.user.avatar == null %}
                        <a href="{{ (path('ornito_user_profile_show', { username : watching.user.username ,  userId : watching.user.id })) }}"><i class="fa fa-user fa-2x shadowed" aria-hidden="true"></i></a>
                      {% else %}
                      <a title="{{ "Voir le profil"|trans }}" href="{{ (path('ornito_user_profile_show', { username : watching.user.username ,  userId : watching.user.id })) }}"><img title="{{ watching.user.username }}" class="profil-picture shadowed" src="/{{ watching.user.avatar.webPath }}" alt="User Picture"></a>
                      {% endif %}
                    </span>
                    <span class="margin-left-10 badge badge-success dropdown-name">{{ watching.user.username }}</span>
                    <i title="Observation" class="fa fa-binoculars"></i>
                  </a>
                </aside>
                <div class="timeline-panel">
                  <div class="obs-status-container">
                    {% if watching.validateStatus == 'untreated' %}
                    <span class="obs-status shadowed text-uppercase float-right font-size-12 italic badge badge badge-warning">
                      {{ "Non Traitée"|trans }}
                      <i class="fa fa-certificate  fa-lg"></i>
                    </span>
                    {% endif %}
                    {% if watching.validateStatus == 'rejected' %}
                    <span class="obs-status shadowed text-uppercase float-right font-size-12 italic badge badge badge-danger">
                      {{ "Rejeté"|trans }}
                      <i class="fa fa-certificate  fa-lg"></i>
                    </span>
                    {% endif %}
                    {% if watching.validateStatus == 'attested' %}
                    <span class="obs-status shadowed text-uppercase float-right font-size-12 italic badge badge badge-danger">
                      {{ "Validé"|trans }}
                      <i class="fa fa-certificate  fa-lg"></i>
                    </span>
                    {% endif %}
                  </div>
                  <div class="timeline-heading">
                    <div class="panelMenu  float-right  btn-group">
                      <!--START Option panel Menu -->
                      <button type="button" class="btn btn-primary btn-sm" data-toggle="dropdown">
                        <i class="fa fa-ellipsis-h"></i>
                      </button>
                      <ul class="dropdown-menu" role="menu">
                        <li>
                          <a href="#">Action</a>
                        </li>
                        <li>
                          <a href="#">Another action</a>
                        </li>
                        <li>
                          <a href="#">Something else</a>
                        </li>
                        <li class="divider"></li>
                        <li>
                          <a href="#">Separated link</a>
                        </li>
                      </ul>
                    </div>
                    <!--END Option panel Menu -->
                    <h4 class="text-uppercase font-size-16 card-title">{{ watching.title }}</h4>
                    <time class="obs-time">
                      <i class="fa fa-calendar"></i>
                      date : {{ watching.date|date('d-m-Y H:i:s') }}</time>
                  </div>
                  <div class="timeline-body">
                    <!-- OBS PANEL -->
                    <div class="obs-panel container">
                      <div class="col-sm-12 col-md-6 row box-shadow">
                        <div class="col-md-12 img-panel-container">
                          {% if watching.species.protectedStatus == true %}
                              {% if watching.species.protectedStatus starts with 'P' %}
                                <span class="badge-status text-uppercase float-right font-size-12 badge shadowed badge-danger">
                                  {{ "Protégé"|trans }}
                                  <i class="fa fa-gavel"></i>
                                </span>
                              {% else %}
                                <span class="badge-status text-uppercase float-right font-size-12 badge shadowed badge-warning">
                                  {{ "En danger"|trans }}
                                  <i class="fa fa-gavel"></i>
                                </span>
                              {%  endif %}
                          {% else %}
                              <span class="badge-status text-uppercase float-right font-size-12 badge shadowed badge-success">
                                {{ "Non menacée"|trans }}
                                <i class="fa fa-gavel"></i>
                              </span>
                          {% endif %}
                          <a href="/{{ watching.image.webPath }}" data-toggle="lightbox">
                            <img  alt="/{{ watching.image.alt}}" title="/{{ watching.image.alt}}" class="img-thumbnail" src="/{{ watching.image.webPath }}">
                          </a>
                        </div>
                        <div class="col-md-12">
                          <div class="obs-row obs-header">
                            <span class="margin-bottom-5 font-size-14 italic badge badge-pill badge-success">
                              {{ "Nom Scientifique"|trans }}
                            </span>
                            <h3 class="font-size-16 toBbold italic">{{ watching.species.scientificName }}
                            </h3>
                            <div class="obs-header-seperator"></div>
                          </div>
                          <div class="obs-row obs-desc">
                            <div>
                              <span class="margin-bottom-5 font-size-12 badge badge-pill badge-warning">
                                {{ "Nom Vernaculaire"|trans }}
                              </span>
                              <h4 class="font-size-14 toBold">
                                {% if watching.species.vernFr == true %}
                                      {{ watching.species.vernFr }}
                                {% else %}
                                      {{ "Non défini"|trans }}
                                {% endif %}
                            </div>
                            <hr>
                            <div>
                              <p>
                                <button class="font-size-14 badge badge-dark  collapsed" type="button" data-toggle="collapse" data-target="#collapseLocalisation" aria-expanded="false" aria-controls="collapseLocalisation">
                                  {{ "Localisation"|trans }}
                                  <i class="fa fa-map-marker"></i>
                                </button>
                              </p>
                              <div class="collapse" id="collapseLocalisation">
                                <div id="localisation-card" class="card card-body">
                                  <ul class="font-size-12 list-group">
                                    <li class="center list-group-item d-flex justify-content-between align-items-center">
                                      {{ "LATITUDE"|trans }}
                                    </li>
                                    <span class="badge badge-primary badge-pill">{{ watching.latitude }}</span>
                                    <li class="list-group-item d-flex justify-content-between align-items-center">
                                      {{ "LONGITUDE"|trans }}
                                    </li>
                                    <span class="badge badge-primary badge-pill">{{ watching.longitude }}</span>
                                  </ul>
                                  <hr>
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                      <hr>
                      <div class="obs-comment col-sm-12 col-md-6">
                        <span id="obsCommentBadge" class="margin-bottom-10 obs-comment-content badge badge-info">{{ "Commentaire"|trans }}</span>
                        <p id="obsCommentContent" class="obs-comment-content">
                            {{ watching.description }}
                        </p>
                        <button type="button" id='obsCommentButton' class="obs-comment-button font-size-12 badge badge-info">
                          Voir le Commentaire
                          <i class="fa fa-eye"></i>
                        </button>
                        <div id="ObsViewMap"></div>
                        <button type="button" class="btn btn-primary btn-lg btn-block">
                          Voir la Map
                          <i class="fa fa-map-pin"></i>
                        </button>
                      </div>
                      <hr>
                    </div>
                  </div>
                  <hr>
                  <div id="commentsystem">
                    <div id="fb-comment"></div>
                  </div>
                </div>
              </li>
            </article>
          </ul>
        </div>
        <!-- END CONTENT -->
      </div>
    </div>
  </div>
  <!-- /#page-content-wrapper -->
  <!-- END CONTENT -->
{% endblock %}
{% block javascripts %}{{ parent() }}
<script type="text/javascript">


  var latitude = {{ watching.latitude }};
  var longitude = {{ watching.longitude }};
  var latiLongi = [latitude, longitude];
  var ObsViewMap = L.map('ObsViewMap').setView([{{ watching.latitude }}, {{ watching.longitude }}], 8);

  L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw', {
    maxZoom: 25,
    attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, ' +
      '<a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
      'Imagery © <a href="http://mapbox.com">Mapbox</a>',
    id: 'mapbox.streets'
  }).addTo(ObsViewMap);


    L.marker(latiLongi).addTo(ObsViewMap)
      .bindPopup("<span class='profil-picture-mini'>{% if watching.user.avatar == null %}<a href='{{ (path('ornito_user_profile_show', {username : watching.user.username ,  userId : watching.user.id})) }}'><i class='fa fa-user fa-2x shadowed' aria-hidden='true'></i></a>{% else %}<a title='{{ "Voir le profil"|trans }}' href='{{ (path('ornito_user_profile_show', {username : watching.user.username ,  userId : watching.user.id})) }}'><img title='{{ watching.user.username }}' class='profil-picture-mini shadowed' src='/{{ watching.user.avatar.webPath }}' alt='UserPicture'></a>{% endif %}<span class='margin-left-10  badge badge-success dropdown-name'>{{ watching.user.username }}</span><h2 class='italic font-size-12'>{{ watching.species.scientificName }}</h2><time class='float-right font-size-1em obs-time'><i class='fa fa-calendar'></i></br>date : {{ watching.date|date('d-m-Y H:i:s') }}</time></span><center class='margin-top-10'><hr><h3 class='text-uppercase font-size-12 card-title'>{{ watching.title }}</h3><hr /><a href='/{{ watching.image.webPath }}' data-toggle='lightbox'><img  alt='/{{ watching.image.alt}}' title='/{{ watching.image.alt}}' class='float-right obs-picture-mini' src='/{{ watching.image.webPath }}'></a><hr /></h2</h2 class='float-left'>Observation dans un périmètre </br> de 100 à 200 metres de ce point </center>").openPopup();

    L.circle(latiLongi, 20000).addTo(ObsViewMap);
    L.circle(latiLongi, 200).addTo(ObsViewMap);

</script>
{% endblock %}
